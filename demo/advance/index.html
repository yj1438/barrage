<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>demo</title>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="yes" name="apple-touch-fullscreen"/>
<meta content="telephone=no,email=no" name="format-detection"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
<style>
  html, body {
    margin: 0;
    height: 100%;
  }
  #barrage {
    height: 40vh;
    background: #eee;
    background-image: url(https://gw.alipayobjects.com/zos/rmsportal/ciHRWZzemAopFLkjWNXY.jpg);
    background-size: cover;
  }
  /* itemmaker è‡ªå®šä¹‰æ ·å¼ */
  .my-barrage-item {
    padding: 2px;
    background-color: rgba(255,255,255,.5);
    border: 1px solid #eee;
    border-radius: 6px;
    line-height: 1.2;
    font-size: 12px;
    cursor: pointer;
  }
  .my-barrage-item.self {
    font-size: 16px;
    margin-top: -2px;
    color: red;
  }
  .my-barrage-item .item-user {
    display: inline-block;
    padding: 2px;
    border: 1px solid #aaa;
    background-color: rgba(255,255,255,.8);
    border-radius: 6px;
  }
  /*  */
  .input-wrap {
    margin: 12px 8px;

    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    justify-content: space-between;
  }
  .input-wrap input {
    flex: 1;
    border: 1px solid #eee;
    border-radius: 2px;
    margin-right: 8px;
    padding: 5px;
    font-size: 16px;
    outline: none;
  }
  .input-wrap button {
    flex-shrink: 0;
    width: 68px;
    height: 30px;
    line-height: 30px;
    border: 1px solid #eee;
    border-radius: 2px;
    padding: 0;
    outline: none;
  }
  .input-wrap button:hover {
    background-color: #eee;
  }
</style>
</head>
<body>
  <!-- å¼¹å¹•æ»šåŠ¨åŒº start -->
  <div id="barrage"></div>
  <!-- å¼¹å¹•æ»šåŠ¨åŒº end -->
  <div class="input-wrap">
    <input id="input" type="text" value=""/>
    <button id="publish">æ¥ä¸€å‘</button>
  </div>
  <div class="input-wrap">
    <button id="btn_stop">åˆ«å¼¹äº†</button>
    <button id="btn_continue">ç»§ç»­å¼¹</button>
  </div>
  <div class="input-wrap">
    ç‚¹å‡»å¼¹å¹•è®©å®ƒæ¶ˆå¤±ï¼
  </div>
  <div style="height: 120vh"></div>

  <script>
    window.luna = {
      config: {
        appId: '@alipay/luna-barrage',
        appName: '@alipay/luna-barrage'
      }
    };
  </script>
  <!-- ä¼šåœ¨å…¨å±€å˜é‡lunaä¸­å¼•å…¥ç»„ä»¶barrage -->
  <script src="../../dist/index.debug.js"></script>

  <script type="text/javascript">
    var main = {
      init: function () {
        console.warn('welcome to barrage example~');
        // æ¨¡æ‹Ÿç”¨æˆ·
        var users = ['å°çº¢', 'å°æ˜', 'å°æ', 'å°ç‹']
        /**
         * ç”Ÿæˆéšæœºé•¿åº¦çš„å¼¹å¹•æ–‡æ¡ˆ
         */
        function makeTestData(count, char) {
          var i = count;
          var data = [];
          while (i > 0) {
            // éšæœºé•¿åº¦
            var randomSize = Math.ceil(Math.random() * 30);
            var str = char;
            while (randomSize > 0) {
              str += char;
              randomSize -= 1;
            }
            data.push({
              text: str,
              type: Math.ceil(Math.random() * 4),
              user: users[Math.floor(Math.random() * 4)]
            });
            i -= 1;
          }
          return data;
        }

        /*
          data: [],                   // åˆå§‹çš„æ•°æ®åˆ—è¡¨
          isLoop: false,              // æ˜¯å¦å¾ªç¯æ’­æ”¾
          rowCount: 5,                // è¡Œæ•°
          intervalTime: 2,            // æœ€çŸ­ä¸¤å¼¹å¹•é—´éš”æ—¶é—´
          speed: 150,                 // ç§»åŠ¨é€Ÿåº¦ px/s
          positionFix: 0,             // ä½ç½®ä¿®æ­£ çºµå‘ä½ç½®ä¿®æ­£
          itemClass: '',              // å¼¹å¹•å…ƒç´  class
          itemMaker: null,            // function å¼¹å¹•å…ƒç´ ç”Ÿæˆå™¨ï¼Œdata ä¸ºå¯¹è±¡åˆ—è¡¨æ—¶ï¼Œæ­¤é¡¹å¿…é¡» function (item) { this === item }
          onClickItem: function       // ç‚¹å‡»å¼¹å¹•å…ƒç´ äº‹ä»¶
        */
        var barrage = new window.luna.Barrage('#barrage', {
          data: makeTestData(20, 'ğŸ˜‚'),
          isLoop: true,
          rowCount: 5,
          intervalTime: 1,
          speed: 200,       // å»ºè®®ä¸è¦è¶…è¿‡200
          positionFix: -12,
          itemClass: 'my-barrage',
          maxDom: 0,
          itemMaker: function (itemData) {
            var html = '<div class="my-barrage-item ' + (itemData.type === 0 ? 'self' : '') + '" >'
              + '<span class="item-user">' + itemData.user + '</span>'
              + '<span class="item-type-' + itemData.type + '">' + itemData.text + '</span>'
              + '</div>'
            return html;
          },
          onClickItem: function (evt) {
            this.remove();
          }
        });
        // å¼€å¯
        barrage.start();
        // æ¨¡æ¿ 15s åè·Ÿè¿›ä¸€æ‰¹æ•°æ®
        setTimeout(function () {
          barrage.append(makeTestData(10, 'ğŸ˜±'));
          // barrage.stop();
        }, 15000);

        // å®æ—¶å‘å¼¹å¹•
        document.getElementById('publish').addEventListener('click', function () {
          var value = document.getElementById('input').value;
          if (value) {
            barrage.publish({
              text: value,
              type: 0,
              user: 'è‡ªå·±'
            });
          }
        }, false);
        // åœæ­¢æ’­æ”¾
        document.getElementById('btn_stop').addEventListener('click', function () {
          barrage.stop();
        }, false);
        // å¼€å§‹æ’­æ”¾
        document.getElementById('btn_continue').addEventListener('click', function () {
          barrage.start();
        }, false);
      }
    };

    window.AlipayJSBridge ? main.init() : document.addEventListener('AlipayJSBridgeReady', function () {
      main.init();
    });
  </script>
</body>
</html>
